<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cat Care">
    <title>Cat Care Tracker - Minou & Matisse</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Nunito:wght@400;600;700&display=swap"
        rel="stylesheet">
    <!-- External CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/health.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Pull to Refresh indicator -->
    <div class="pull-to-refresh" id="pullToRefresh">
        <span class="pull-icon">üîÑ</span>
        <span class="pull-text">Rilascia per aggiornare</span>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üê±</span>
                <h1>Cat Care</h1>
            </div>
            <div class="subtitle">
                <span class="cat-names">
                    <span class="cat-name minou">Minou</span>
                    <span class="cat-name matisse">Matisse</span>
                </span>
            </div>
        </header>

        <!-- Install Prompt (shown only when installable) -->
        <div class="install-prompt" id="installPrompt" style="display: none;">
            <h3>üì≤ Installa l'app</h3>
            <p>Aggiungi Cat Care alla schermata home per accedere rapidamente!</p>
            <button class="install-btn" id="installBtn">
                <span>‚¨áÔ∏è</span> Installa
            </button>
            <button class="install-dismiss" id="installDismiss">Non ora</button>
        </div>

        <!-- Tab: Home -->
        <section id="tab-home" class="tabs-content active">
            <!-- Next Cleaning Alert -->
            <div class="next-alert" id="nextAlert">
                <div class="next-alert-header">
                    <span class="next-alert-icon">üîî</span>
                    <h3>Prossima pulizia</h3>
                </div>
                <div class="next-alert-content">
                    <div class="next-alert-toilet" id="nextToilet">Bagno Grande</div>
                    <div class="next-alert-date">
                        <div class="date" id="nextDate">14 Dic</div>
                        <div class="days" id="nextDays">tra 7 giorni</div>
                    </div>
                </div>
            </div>

            <!-- Toilets Section -->
            <section class="section">
                <h2 class="section-title">üöΩ Stato Toilette</h2>
                <div class="toilet-grid">
                    <!-- Bagno Grande -->
                    <div class="toilet-card grande">
                        <div class="toilet-header">
                            <div class="toilet-info">
                                <h3>Bagno Grande</h3>
                                <div class="toilet-location">üìç Bagno principale</div>
                            </div>
                            <span class="toilet-icon">ü™£</span>
                        </div>
                        <div class="toilet-status">
                            <div class="status-row">
                                <span class="status-label">Ultima pulizia</span>
                                <span class="status-value skeleton skeleton-text" id="grandeLastClean"
                                    style="width: 80px;">&nbsp;</span>
                            </div>
                            <div class="status-row">
                                <span class="status-label">Stato</span>
                                <span class="status-badge ok" id="grandeStatus">
                                    <span>‚úì</span> Pulita
                                </span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ok" id="grandeProgress" style="width: 30%"></div>
                            </div>
                        </div>
                        <button class="clean-btn grande" onclick="showConfirmModal('grande')">
                            <span>‚ú®</span> Segna come pulita
                        </button>
                    </div>

                    <!-- Bagno Piccolo -->
                    <div class="toilet-card piccolo">
                        <div class="toilet-header">
                            <div class="toilet-info">
                                <h3>Bagno Piccolo</h3>
                                <div class="toilet-location">üìç Bagno secondario</div>
                            </div>
                            <span class="toilet-icon">ü™£</span>
                        </div>
                        <div class="toilet-status">
                            <div class="status-row">
                                <span class="status-label">Ultima pulizia</span>
                                <span class="status-value skeleton skeleton-text" id="piccoloLastClean"
                                    style="width: 80px;">&nbsp;</span>
                            </div>
                            <div class="status-row">
                                <span class="status-label">Stato</span>
                                <span class="status-badge ok" id="piccoloStatus">
                                    <span>‚úì</span> Pulita
                                </span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ok" id="piccoloProgress" style="width: 30%"></div>
                            </div>
                        </div>
                        <button class="clean-btn piccolo" onclick="showConfirmModal('piccolo')">
                            <span>‚ú®</span> Segna come pulita
                        </button>
                    </div>
                </div>
            </section>
    </div>

    <!-- Tab: History -->
    <div class="tabs-content" id="tab-history">
        <section class="section">
            <h2 class="section-title">üìã Storico Pulizie</h2>
            <div class="history-list" id="historyList">
                <!-- Populated by JS -->
            </div>
        </section>
    </div>

    <!-- Tab: Health -->
    <div class="tabs-content" id="tab-health">
        <div class="health-header">
            <h2>Salute & Veterinario</h2>
        </div>

        <!-- Cat Profiles -->
        <div class="cat-profiles-container">
            <!-- Minou -->
            <div class="cat-profile-card minou" onclick="showCatProfile('minou')">
                <div class="cat-avatar">üê±</div>
                <div class="cat-info">
                    <h3>Minou</h3>
                    <div class="cat-weight skeleton skeleton-text" style="width: 50px;">&nbsp;</div>
                    <div class="next-event-badge skeleton skeleton-text" style="width: 100px;">
                        &nbsp;
                    </div>
                </div>
            </div>

            <!-- Matisse -->
            <div class="cat-profile-card matisse" onclick="showCatProfile('matisse')">
                <div class="cat-avatar">üê±</div>
                <div class="cat-info">
                    <h3>Matisse</h3>
                    <div class="cat-weight skeleton skeleton-text" style="width: 50px;">&nbsp;</div>
                    <div class="next-event-badge skeleton skeleton-text" style="width: 100px;">
                        &nbsp;
                    </div>
                </div>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- Health Timeline -->
        <div class="health-actions">
            <h3>Diario Clinico</h3>
            <button class="btn-primary-small" onclick="showAddHealthEvent()">+ Nuovo Evento</button>
        </div>

        <!-- Weight Chart -->
        <div class="chart-container">
            <canvas id="weightChart"></canvas>
        </div>

        <div class="health-timeline" id="healthTimeline">
            <!-- Populated by JS -->
        </div>
    </div>
    <!-- Health Event Modal -->
    <div class="modal-overlay" id="healthEventModal">
        <div class="modal">
            <input type="hidden" id="eventId">
            <div class="modal-icon text-center" style="text-align: center; font-size: 2.5rem; margin-bottom: 10px;">üè•
            </div>
            <h3 style="text-align: center; margin-bottom: 20px;">Nuovo Evento</h3>

            <div class="form-group">
                <label>Gatto</label>
                <div class="cat-selector">
                    <button class="cat-select-btn active" id="eventCatMinou"
                        onclick="selectEventCat('minou')">Minou</button>
                    <button class="cat-select-btn" id="eventCatMatisse"
                        onclick="selectEventCat('matisse')">Matisse</button>
                    <button class="cat-select-btn" id="eventCatBoth" onclick="selectEventCat('both')">Entrambe</button>
                </div>
            </div>

            <div class="form-group">
                <label>Tipo Evento</label>
                <select id="eventType" class="form-input" onchange="toggleWeightInput(this)"
                    style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-primary); font-size: 1rem;">
                    <option value="vaccine">üíâ Vaccino</option>
                    <option value="vet">üë®‚Äç‚öïÔ∏è Visita</option>
                    <option value="meds">üíä Antiparassitario</option>
                    <option value="weight">‚öñÔ∏è Peso</option>
                    <option value="note">üìù Nota</option>
                </select>
            </div>

            <div class="form-group" id="weightInputGroup" style="display: none;">
                <label>Peso (kg)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="number" id="eventWeight" class="form-input" step="0.1" placeholder="0.0"
                        style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); font-size: 1.2rem; text-align: center; font-weight: bold;">
                </div>
            </div>

            <div class="form-group">
                <label>Data</label>
                <input type="date" id="eventDate" class="form-input"
                    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);">
            </div>

            <div class="form-group">
                <label>Note</label>
                <input type="text" id="eventNote" class="form-input"
                    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);"
                    placeholder="Dettagli...">
            </div>

            <div class="form-group">
                <label>Costo (‚Ç¨)</label>
                <input type="number" id="eventCost" class="form-input"
                    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);"
                    placeholder="0.00" step="0.01">
            </div>

            <div class="form-group">
                <label>Prossima Scadenza (Opzionale)</label>
                <input type="date" id="eventNextDate" class="form-input"
                    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);">
            </div>

            <div class="modal-buttons">
                <button class="modal-btn danger" id="btnDeleteHealthEvent" onclick="deleteHealthEvent()"
                    style="display: none;">Elimina</button>
                <button class="modal-btn secondary" onclick="closeModal('healthEventModal')">Annulla</button>
                <button class="modal-btn primary" onclick="saveHealthEvent()">Salva</button>
            </div>
        </div>
    </div>

    <!-- Tab: Food -->
    <div class="tabs-content" id="tab-food">
        <section class="section">
            <h2 class="section-title">üçΩÔ∏è Gestione Cibo</h2>

            <!-- Alert scorte basse -->
            <div class="low-stock-alert" id="lowStockAlert" style="display: none;">
                <div class="alert-icon">‚ö†Ô∏è</div>
                <div class="alert-content">
                    <strong>Scorte basse!</strong>
                    <p id="lowStockText">Alcuni prodotti stanno finendo</p>
                </div>
            </div>

            <!-- Riepilogo scorte -->
            <div class="food-summary">
                <div class="summary-item">
                    <span class="summary-icon">ü•´</span>
                    <span class="summary-value" id="totalCans">0</span>
                    <span class="summary-label">Scatolette</span>
                </div>
                <div class="summary-item">
                    <span class="summary-icon">ü•£</span>
                    <span class="summary-value" id="totalKibble">0</span>
                    <span class="summary-label">Kg Crocchette</span>
                </div>
            </div>

            <!-- Lista prodotti -->
            <div class="food-section">
                <div class="food-section-header">
                    <h3>ü•´ Scatolette</h3>
                    <button class="add-btn" onclick="showAddProductModal('scatoletta')">+ Aggiungi</button>
                </div>
                <div class="food-list" id="cansList">
                    <!-- Populated by JS -->
                </div>
            </div>

            <div class="food-section">
                <div class="food-section-header">
                    <h3>ü•£ Crocchette</h3>
                    <button class="add-btn" onclick="showAddProductModal('crocchette')">+ Aggiungi</button>
                </div>
                <div class="food-list" id="kibbleList">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Preferenze gatte -->
            <div class="food-section">
                <div class="food-section-header">
                    <h3>‚ù§Ô∏è Preferenze Gatte</h3>
                </div>
                <div class="preferences-grid">
                    <div class="preference-card minou-pref">
                        <div class="pref-header">
                            <span class="pref-cat-name">Minou</span>
                            <span class="pref-cat-emoji">üê±</span>
                        </div>
                        <div class="pref-list" id="minouPrefs">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="preference-card matisse-pref">
                        <div class="pref-header">
                            <span class="pref-cat-name">Matisse</span>
                            <span class="pref-cat-emoji">üê±</span>
                        </div>
                        <div class="pref-list" id="matissePrefs">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div> <!-- Closing tab-food -->

    <!-- Tab: Settings -->
    <div class="tabs-content" id="tab-settings">
        <section class="section">
            <h2 class="section-title">‚öôÔ∏è Impostazioni</h2>

            <div class="settings-card">
                <h3>üîî Notifiche</h3>
                <div class="setting-row">
                    <span class="setting-label">Abilita notifiche</span>
                    <label class="toggle">
                        <input type="checkbox" id="notificationsToggle" onchange="toggleNotifications()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Promemoria giorno prima</span>
                    <label class="toggle">
                        <input type="checkbox" id="dayBeforeToggle" checked onchange="saveSettings()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-card">
                <h3>üçΩÔ∏è Gestione Cibo</h3>
                <div class="settings-group">
                    <button class="settings-btn" onclick="openManageListModal('brands')">
                        <span class="btn-icon">üè∑Ô∏è</span>
                        <span class="btn-text">Gestisci Marche</span>
                        <span class="btn-arrow">‚ùØ</span>
                    </button>
                    <div class="divider"></div>
                    <button class="settings-btn" onclick="openManageListModal('flavors')">
                        <span class="btn-icon">üçΩÔ∏è</span>
                        <span class="btn-text">Gestisci Gusti</span>
                        <span class="btn-arrow">‚ùØ</span>
                    </button>
                </div>
            </div>

            <div class="settings-card">
                <h3>‚òÅÔ∏è Sincronizzazione</h3>
                <div class="setting-row">
                    <span class="setting-label">Stato</span>
                    <span class="sync-status" id="syncStatus">
                        <span class="sync-dot offline"></span>
                        <span id="syncStatusText">Non configurato</span>
                    </span>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Ultima sync</span>
                    <span class="setting-value" id="lastSyncTime">Mai</span>
                </div>
                <button class="sync-btn" id="syncConfigBtn" onclick="showSyncConfigModal()">
                    ‚öôÔ∏è Configura GitHub Token
                </button>
                <button class="sync-btn secondary" id="syncNowBtn" onclick="syncNow()" style="display: none;">
                    üîÑ Sincronizza ora
                </button>
            </div>

            <div class="settings-card">
                <h3>‚è±Ô∏è Intervallo pulizia</h3>
                <div class="setting-row">
                    <span class="setting-label">Giorni tra le pulizie</span>
                    <span class="setting-value" id="intervalValue">15 giorni</span>
                </div>
            </div>

            <div class="settings-card">
                <h3>üê± Le tue gatte</h3>
                <div class="setting-row">
                    <span class="setting-label">Minou</span>
                    <span class="cat-name minou">üê±</span>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Matisse</span>
                    <span class="cat-name matisse">üê±</span>
                </div>
            </div>

            <div class="settings-card">
                <h3>üì± App</h3>
                <div class="setting-row">
                    <span class="setting-value" id="appVersion">--</span>
                </div>
                <div class="setting-row">
                    <span class="setting-label">Tema</span>
                    <span class="setting-value">Automatico</span>
                </div>
            </div>
        </section>
    </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-tab="home">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </button>
        <button class="nav-item" data-tab="food">
            <span class="nav-icon">üçΩÔ∏è</span>
            <span class="nav-label">Cibo</span>
        </button>
        <button class="nav-item" data-tab="history">
            <span class="nav-icon">üìã</span>
            <span class="nav-label">Storico</span>
        </button>
        <button class="nav-item" data-tab="health">
            <span class="nav-icon">üè•</span>
            <span class="nav-label">Salute</span>
        </button>
        <button class="nav-item" data-tab="settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Setup</span>
        </button>
    </nav>

    <!-- Sync Config Modal -->
    <div class="modal-overlay" id="syncConfigModal">
        <div class="modal">
            <div class="modal-icon">üîë</div>
            <h3>Configura GitHub</h3>
            <p>Inserisci il tuo Personal Access Token per sincronizzare i dati</p>
            <div class="input-wrapper">
                <label for="githubToken">GitHub Token:</label>
                <input type="password" id="githubToken" class="text-input" placeholder="ghp_xxxxxxxxxxxx">
                <div class="token-help">
                    <small>Il token viene salvato solo sul tuo dispositivo e non viene mai condiviso.</small>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn secondary" onclick="closeModal('syncConfigModal')">Annulla</button>
                    <button class="modal-btn primary" onclick="saveSyncConfig()">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cat Profile Modal -->
    <div class="modal-overlay" id="catProfileModal">
        <div class="modal">
            <div class="modal-icon" id="catProfileIcon">üê±</div>
            <h3 id="catProfileTitle">Profilo Gatto</h3>

            <input type="hidden" id="currentCatId">

            <div class="form-group" style="text-align: center; margin-bottom: 20px;">
                <label>Peso (kg)</label>
                <div style="display: flex; align-items: center; gap: 10px; justify-content: center;">
                    <button class="qty-btn minus" onclick="adjustWeight(-0.1)">-</button>
                    <input type="number" id="catWeight" step="0.1"
                        style="font-size: 1.5rem; width: 80px; text-align: center; border: none; font-weight: bold; font-family: 'Quicksand', sans-serif;"
                        readonly>
                    <button class="qty-btn plus" onclick="adjustWeight(0.1)">+</button>
                </div>
            </div>

            <div class="form-group">
                <label>Data di Nascita</label>
                <input type="date" id="catBirthDate" class="form-input"
                    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);">
            </div>

            <div class="form-group">
                <label>Microchip</label>
                <input type="text" id="catChip" class="form-input"
                    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border);"
                    placeholder="Numero Microchip">
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal('catProfileModal')">Annulla</button>
                <button class="modal-btn primary" onclick="saveCatProfile()">Salva</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal modal-large">
            <div class="modal-icon">ü•´</div>
            <h3 id="productModalTitle">Aggiungi Prodotto</h3>

            <div class="modal-body">
                <div class="input-wrapper">
                    <label for="productBrand">Marca:</label>
                    <select id="productBrand" class="text-input">
                        <option value="">Seleziona marca...</option>
                    </select>
                </div>

                <div class="input-wrapper">
                    <label for="productFlavor">Gusto:</label>
                    <select id="productFlavor" class="text-input">
                        <option value="">Seleziona gusto...</option>
                    </select>
                </div>

                <div class="input-wrapper" id="sizeWrapper">
                    <label for="productSize">Formato:</label>
                    <select id="productSize" class="text-input">
                        <option value="50g">50g</option>
                        <option value="70g">70g</option>
                        <option value="85g" selected>85g</option>
                        <option value="400g">400g</option>
                    </select>
                </div>

                <div class="input-wrapper">
                    <label for="productQuantity">Quantit√† in stock:</label>
                    <input type="number" id="productQuantity" class="text-input" min="0" value="0">
                </div>

                <div class="input-wrapper">
                    <label>Piace a:</label>
                    <div class="preference-checkboxes">
                        <label class="pref-checkbox">
                            <input type="checkbox" id="likesMinou" checked>
                            <span class="pref-check-label minou">Minou üê±</span>
                        </label>
                        <label class="pref-checkbox">
                            <input type="checkbox" id="likesMatisse" checked>
                            <span class="pref-check-label matisse">Matisse üê±</span>
                        </label>
                    </div>
                </div>

                <div class="input-wrapper">
                    <label>Valutazione:</label>
                    <div class="rating-selector">
                        <button type="button" class="rating-btn" data-rating="love" onclick="setRating('love')">‚ù§Ô∏è
                            Adorano</button>
                        <button type="button" class="rating-btn active" data-rating="like"
                            onclick="setRating('like')">üëç
                            Piace</button>
                        <button type="button" class="rating-btn" data-rating="ok" onclick="setRating('ok')">üòê
                            Ok</button>
                        <button type="button" class="rating-btn" data-rating="dislike" onclick="setRating('dislike')">üëé
                            No</button>
                    </div>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeProductModal()">Annulla</button>
                <button class="modal-btn confirm" onclick="saveProduct()">Salva</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <div class="modal-icon">‚ú®</div>
            <h3>Conferma pulizia</h3>
            <p id="modalText">Hai pulito la toilette del Bagno Grande?</p>
            <div class="date-picker-wrapper">
                <label for="cleaningDate">Data Pulizia (Tocca per cambiare):</label>
                <input type="date" id="cleaningDate" class="date-input">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal()">Annulla</button>
                <button class="modal-btn confirm" id="confirmBtn">Conferma</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-icon">üìù</div>
            <h3>Modifica pulizia</h3>
            <p id="editModalText">Modifica la data di pulizia</p>
            <div class="date-picker-wrapper">
                <label for="editDate">Nuova Data:</label>
                <input type="date" id="editDate" class="date-input">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeEditModal()">Annulla</button>
                <button class="modal-btn confirm" id="editConfirmBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span>‚úÖ</span>
        <span id="toastText">Pulizia registrata!</span>
    </div>


    <script src="js/sync.js"></script>
    <script src="js/toilets.js"></script>
    <!-- Generic List Management Modal -->
    <div class="modal-overlay" id="listManagerModal">
        <div class="modal">
            <h3 id="listManagerTitle">Gestisci Lista</h3>
            <div class="modal-body">
                <div class="add-item-row">
                    <input type="text" id="newItemInput" class="text-input" placeholder="Nuovo elemento...">
                    <button class="action-btn add-btn" onclick="addListItem()">+</button>
                </div>
                <div id="manageListItems" class="manage-list">
                    <!-- Items will be populated here -->
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="closeListManagerModal()">Chiudi</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/food.js"></script>
    <script src="js/health.js"></script>
</body>

</html>