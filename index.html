<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cat Care">
    <title>Cat Care Tracker - Minou & Matisse</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Pull to Refresh indicator -->
    <div class="pull-to-refresh" id="pullToRefresh">
        <span class="pull-icon">üîÑ</span>
        <span class="pull-text">Rilascia per aggiornare</span>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üê±</span>
                <h1>Cat Care</h1>
            </div>
            <div class="subtitle">
                <span class="cat-names">
                    <span class="cat-name minou">Minou</span>
                    <span class="cat-name matisse">Matisse</span>
                </span>
            </div>
        </header>

        <!-- Install Prompt (shown only when installable) -->
        <div class="install-prompt" id="installPrompt" style="display: none;">
            <h3>üì≤ Installa l'app</h3>
            <p>Aggiungi Cat Care alla schermata home per accedere rapidamente!</p>
            <button class="install-btn" id="installBtn">
                <span>‚¨áÔ∏è</span> Installa
            </button>
            <button class="install-dismiss" id="installDismiss">Non ora</button>
        </div>

        <!-- Tab: Home -->
        <div class="tab-content active" id="tabHome">
            <!-- Next Cleaning Alert -->
            <div class="next-alert" id="nextAlert">
                <div class="next-alert-header">
                    <span class="next-alert-icon">üîî</span>
                    <h3>Prossima pulizia</h3>
                </div>
                <div class="next-alert-content">
                    <div class="next-alert-toilet" id="nextToilet">Bagno Grande</div>
                    <div class="next-alert-date">
                        <div class="date" id="nextDate">14 Dic</div>
                        <div class="days" id="nextDays">tra 7 giorni</div>
                    </div>
                </div>
            </div>

            <!-- Toilets Section -->
            <section class="section">
                <h2 class="section-title">üöΩ Stato Toilette</h2>
                <div class="toilet-grid">
                    <!-- Bagno Grande -->
                    <div class="toilet-card grande">
                        <div class="toilet-header">
                            <div class="toilet-info">
                                <h3>Bagno Grande</h3>
                                <div class="toilet-location">üìç Bagno principale</div>
                            </div>
                            <span class="toilet-icon">ü™£</span>
                        </div>
                        <div class="toilet-status">
                            <div class="status-row">
                                <span class="status-label">Ultima pulizia</span>
                                <span class="status-value" id="grandeLastClean">--</span>
                            </div>
                            <div class="status-row">
                                <span class="status-label">Stato</span>
                                <span class="status-badge ok" id="grandeStatus">
                                    <span>‚úì</span> Pulita
                                </span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ok" id="grandeProgress" style="width: 30%"></div>
                            </div>
                        </div>
                        <button class="clean-btn grande" onclick="showConfirmModal('grande')">
                            <span>‚ú®</span> Segna come pulita
                        </button>
                    </div>

                    <!-- Bagno Piccolo -->
                    <div class="toilet-card piccolo">
                        <div class="toilet-header">
                            <div class="toilet-info">
                                <h3>Bagno Piccolo</h3>
                                <div class="toilet-location">üìç Bagno secondario</div>
                            </div>
                            <span class="toilet-icon">ü™£</span>
                        </div>
                        <div class="toilet-status">
                            <div class="status-row">
                                <span class="status-label">Ultima pulizia</span>
                                <span class="status-value" id="piccoloLastClean">--</span>
                            </div>
                            <div class="status-row">
                                <span class="status-label">Stato</span>
                                <span class="status-badge ok" id="piccoloStatus">
                                    <span>‚úì</span> Pulita
                                </span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ok" id="piccoloProgress" style="width: 30%"></div>
                            </div>
                        </div>
                        <button class="clean-btn piccolo" onclick="showConfirmModal('piccolo')">
                            <span>‚ú®</span> Segna come pulita
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Tab: History -->
        <div class="tab-content" id="tabHistory">
            <section class="section">
                <h2 class="section-title">üìã Storico Pulizie</h2>
                <div class="history-list" id="historyList">
                    <!-- Populated by JS -->
                </div>
            </section>
        </div>

        <!-- Tab: Food -->
        <div class="tab-content" id="tabFood">
            <section class="section">
                <h2 class="section-title">üçΩÔ∏è Gestione Cibo</h2>
                
                <!-- Alert scorte basse -->
                <div class="low-stock-alert" id="lowStockAlert" style="display: none;">
                    <div class="alert-icon">‚ö†Ô∏è</div>
                    <div class="alert-content">
                        <strong>Scorte basse!</strong>
                        <p id="lowStockText">Alcuni prodotti stanno finendo</p>
                    </div>
                </div>

                <!-- Riepilogo scorte -->
                <div class="food-summary">
                    <div class="summary-item">
                        <span class="summary-icon">ü•´</span>
                        <span class="summary-value" id="totalCans">0</span>
                        <span class="summary-label">Scatolette</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-icon">ü•£</span>
                        <span class="summary-value" id="totalKibble">0</span>
                        <span class="summary-label">Kg Crocchette</span>
                    </div>
                </div>

                <!-- Lista prodotti -->
                <div class="food-section">
                    <div class="food-section-header">
                        <h3>ü•´ Scatolette</h3>
                        <button class="add-btn" onclick="showAddProductModal('scatoletta')">+ Aggiungi</button>
                    </div>
                    <div class="food-list" id="cansList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="food-section">
                    <div class="food-section-header">
                        <h3>ü•£ Crocchette</h3>
                        <button class="add-btn" onclick="showAddProductModal('crocchette')">+ Aggiungi</button>
                    </div>
                    <div class="food-list" id="kibbleList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Preferenze gatte -->
                <div class="food-section">
                    <div class="food-section-header">
                        <h3>‚ù§Ô∏è Preferenze Gatte</h3>
                    </div>
                    <div class="preferences-grid">
                        <div class="preference-card minou-pref">
                            <div class="pref-header">
                                <span class="pref-cat-name">Minou</span>
                                <span class="pref-cat-emoji">üê±</span>
                            </div>
                            <div class="pref-list" id="minouPrefs">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        <div class="preference-card matisse-pref">
                            <div class="pref-header">
                                <span class="pref-cat-name">Matisse</span>
                                <span class="pref-cat-emoji">üê±</span>
                            </div>
                            <div class="pref-list" id="matissePrefs">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Tab: Settings -->
        <div class="tab-content" id="tabSettings">
            <section class="section">
                <h2 class="section-title">‚öôÔ∏è Impostazioni</h2>

                <div class="settings-card">
                    <h3>üîî Notifiche</h3>
                    <div class="setting-row">
                        <span class="setting-label">Abilita notifiche</span>
                        <label class="toggle">
                            <input type="checkbox" id="notificationsToggle" onchange="toggleNotifications()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <span class="setting-label">Promemoria giorno prima</span>
                        <label class="toggle">
                            <input type="checkbox" id="dayBeforeToggle" checked onchange="saveSettings()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>‚òÅÔ∏è Sincronizzazione</h3>
                    <div class="setting-row">
                        <span class="setting-label">Stato</span>
                        <span class="sync-status" id="syncStatus">
                            <span class="sync-dot offline"></span>
                            <span id="syncStatusText">Non configurato</span>
                        </span>
                    </div>
                    <div class="setting-row">
                        <span class="setting-label">Ultima sync</span>
                        <span class="setting-value" id="lastSyncTime">Mai</span>
                    </div>
                    <button class="sync-btn" id="syncConfigBtn" onclick="showSyncConfigModal()">
                        ‚öôÔ∏è Configura GitHub Token
                    </button>
                    <button class="sync-btn secondary" id="syncNowBtn" onclick="syncNow()" style="display: none;">
                        üîÑ Sincronizza ora
                    </button>
                </div>

                <div class="settings-card">
                    <h3>‚è±Ô∏è Intervallo pulizia</h3>
                    <div class="setting-row">
                        <span class="setting-label">Giorni tra le pulizie</span>
                        <span class="setting-value" id="intervalValue">15 giorni</span>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>üê± Le tue gatte</h3>
                    <div class="setting-row">
                        <span class="setting-label">Minou</span>
                        <span class="cat-name minou">üê±</span>
                    </div>
                    <div class="setting-row">
                        <span class="setting-label">Matisse</span>
                        <span class="cat-name matisse">üê±</span>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>üì± App</h3>
                    <div class="setting-row">
                        <span class="setting-label">Versione</span>
                        <span class="setting-value">2.0.0</span>
                    </div>
                    <div class="setting-row">
                        <span class="setting-label">Tema</span>
                        <span class="setting-value">Automatico</span>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-tab="Home">
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
        </button>
        <button class="nav-btn" data-tab="Food">
            <span class="nav-icon">üçΩÔ∏è</span>
            <span class="nav-label">Cibo</span>
        </button>
        <button class="nav-btn" data-tab="History">
            <span class="nav-icon">üìã</span>
            <span class="nav-label">Storico</span>
        </button>
        <button class="nav-btn" data-tab="Settings">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Impostazioni</span>
        </button>
    </nav>

    <!-- Sync Config Modal -->
    <div class="modal-overlay" id="syncConfigModal">
        <div class="modal">
            <div class="modal-icon">üîë</div>
            <h3>Configura GitHub</h3>
            <p>Inserisci il tuo Personal Access Token per sincronizzare i dati</p>
            <div class="input-wrapper">
                <label for="githubToken">GitHub Token:</label>
                <input type="password" id="githubToken" class="text-input" placeholder="ghp_xxxxxxxxxxxx">
            </div>
            <div class="token-help">
                <small>Il token viene salvato solo sul tuo dispositivo e non viene mai condiviso.</small>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeSyncConfigModal()">Annulla</button>
                <button class="modal-btn confirm" onclick="saveSyncConfig()">Salva</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal modal-large">
            <div class="modal-icon">ü•´</div>
            <h3 id="productModalTitle">Aggiungi Prodotto</h3>
            
            <div class="input-wrapper">
                <label for="productBrand">Marca:</label>
                <select id="productBrand" class="text-input">
                    <option value="">Seleziona marca...</option>
                    <option value="Natural Code">Natural Code</option>
                    <option value="Schesir">Schesir</option>
                    <option value="Oasy">Oasy</option>
                    <option value="Life Cat">Life Cat</option>
                    <option value="Farmina">Farmina</option>
                    <option value="Altro">Altro...</option>
                </select>
            </div>
            
            <div class="input-wrapper" id="customBrandWrapper" style="display: none;">
                <label for="customBrand">Nome marca:</label>
                <input type="text" id="customBrand" class="text-input" placeholder="Inserisci marca">
            </div>
            
            <div class="input-wrapper">
                <label for="productFlavor">Gusto:</label>
                <select id="productFlavor" class="text-input">
                    <option value="">Seleziona gusto...</option>
                    <option value="Tonno">Tonno</option>
                    <option value="Pollo">Pollo</option>
                    <option value="Tacchino">Tacchino</option>
                    <option value="Tonno e Pollo">Tonno e Pollo</option>
                    <option value="Tonno e Tacchino">Tonno e Tacchino</option>
                    <option value="Pollo e Tacchino">Pollo e Tacchino</option>
                    <option value="Manzo">Manzo</option>
                    <option value="Pesce">Pesce</option>
                    <option value="Misto">Misto</option>
                    <option value="Altro">Altro...</option>
                </select>
            </div>
            
            <div class="input-wrapper" id="customFlavorWrapper" style="display: none;">
                <label for="customFlavor">Nome gusto:</label>
                <input type="text" id="customFlavor" class="text-input" placeholder="Inserisci gusto">
            </div>
            
            <div class="input-wrapper" id="sizeWrapper">
                <label for="productSize">Formato:</label>
                <select id="productSize" class="text-input">
                    <option value="50g">50g</option>
                    <option value="70g">70g</option>
                    <option value="85g" selected>85g</option>
                    <option value="400g">400g</option>
                </select>
            </div>
            
            <div class="input-wrapper">
                <label for="productQuantity">Quantit√† in stock:</label>
                <input type="number" id="productQuantity" class="text-input" min="0" value="0">
            </div>
            
            <div class="input-wrapper">
                <label>Piace a:</label>
                <div class="preference-checkboxes">
                    <label class="pref-checkbox">
                        <input type="checkbox" id="likesMinou" checked>
                        <span class="pref-check-label minou">Minou üê±</span>
                    </label>
                    <label class="pref-checkbox">
                        <input type="checkbox" id="likesMatisse" checked>
                        <span class="pref-check-label matisse">Matisse üê±</span>
                    </label>
                </div>
            </div>
            
            <div class="input-wrapper">
                <label>Valutazione:</label>
                <div class="rating-selector">
                    <button type="button" class="rating-btn" data-rating="love" onclick="setRating('love')">‚ù§Ô∏è Adorano</button>
                    <button type="button" class="rating-btn active" data-rating="like" onclick="setRating('like')">üëç Piace</button>
                    <button type="button" class="rating-btn" data-rating="ok" onclick="setRating('ok')">üòê Ok</button>
                    <button type="button" class="rating-btn" data-rating="dislike" onclick="setRating('dislike')">üëé No</button>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeProductModal()">Annulla</button>
                <button class="modal-btn confirm" onclick="saveProduct()">Salva</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal">
            <div class="modal-icon">‚ú®</div>
            <h3>Conferma pulizia</h3>
            <p id="modalText">Hai pulito la toilette del Bagno Grande?</p>
            <div class="date-picker-wrapper">
                <label for="cleaningDate">Data pulizia:</label>
                <input type="date" id="cleaningDate" class="date-input">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeModal()">Annulla</button>
                <button class="modal-btn confirm" id="confirmBtn">Conferma</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-icon">üìù</div>
            <h3>Modifica pulizia</h3>
            <p id="editModalText">Modifica la data di pulizia</p>
            <div class="date-picker-wrapper">
                <label for="editDate">Nuova data:</label>
                <input type="date" id="editDate" class="date-input">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeEditModal()">Annulla</button>
                <button class="modal-btn confirm" id="editConfirmBtn">Salva</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span>‚úÖ</span>
        <span id="toastText">Pulizia registrata!</span>
    </div>


    <!-- JavaScript Files -->
    <script src="js/app.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/toilets.js"></script>
    <script src="js/food.js"></script>
</body>
</html>
